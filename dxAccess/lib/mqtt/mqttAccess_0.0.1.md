# MQTT协议文档


## 一. 规则


| 参数名     | 数据类型   | 数据范围 | 说明                                                         |
| --------  | ------ | ---- | ------------------------------------------------------------ |
| serialNo    | string | 序列号格式，长度6-32   | 服务端与客户端每一次的应答应保持一致 |
| uuid     | string | UUID格式，长度6-32   | 设备唯一标识，大于8位的字符串.                                             |
| data      | object | 跟随协议   | 指令请求携带的数据，参见指令部分 |
| time           | long   | 时间戳格式   | 报文发送的时间戳，单位秒                                       |
| sign          | string | 签名格式，长度0-128   | 消息签名，如果签名启动，这个值必须有，验证数据的合法性，暂不使用 |
| code          | string | 6位数字，参见附录1   | 结果码，只有指令返回的报文存在这个字段 |

注：设备属于客户端角色

## 二. 指令类型


### 1. 设备管理接口

#### 1.1 配置查询


- 服务端： access_device/v2/cmd/{uuid}/getConfig

| 参数名 | 数据类型 | 数据范围  | 说明 |
| ----- | ----- | ----  | ------------------------------------------------------ |
| data   | string | 配置项，参见设备配置文档，长度0-128     | 查询设备配置信息，1、不传或为空字符串则返回所有配置，2、"组名.组员" 返回单个配置项，3、"组名" 返回一组配置 |

- 客户端：access_device/v2/cmd/getConfig\_reply

| 参数名 | 数据类型 | 数据范围  | 说明 |
| ----- | ----- | ----  | ------------------------------------------------------ |
| data   | object | 配置项，参见设备配置文档     | 如果查询成功则返回查询到的配置，否则返回失败原因 |


示例1：

```json
// 获取所有配置
// 服务端
{
    "serialNo": "6w8keif5g6",
    "uuid": "123456",
    "time": 1756571618,
    "data": "",
    "sign": ""
}
// 客户端
{
	"serialNo": "6w8keif5g6",
	"uuid": "123456",
    "time": 1756571619,
	"data": {
		"sys": {
			"uuid":"123456",
            ...
        },
        "access": {
            "offlineAcsNum":2000,
            ...
        },
        ...// 完整配置参见设备配置文档
	},
    "sign": "",
	"code": "000000"
}
```
示例2：

```json
//获取单个配置
// 服务端
{
	"serialNo": "6w8keif5g6",
	"uuid": "1b89e112c70940f0",
	"time": 1647580466,
	"data":"sys.uuid",
	"sign": ""
}
// 客户端
{
	"serialNo": "6w8keif5g6",
	"uuid": "123456",
    "time": 1756571619,
	"data": {
		"sys": {
			"uuid":"123456",
        }
	},
    "sign": "",
	"code": "000000"
}
```


#### 1.2 配置修改

- 服务端： access_device/v2/cmd/{uuid}/setConfig

| 参数名 | 数据类型 | 数据范围  | 说明 |
| ----- | ----- | ----  | ------------------------------------------------------ |
| data   | object | json格式，参见设备配置文档     | 修改设备配置，"组名.组员" |

- 客户端：access_device/v2/cmd/setConfig\_reply

| 参数名 | 数据类型 | 数据范围  | 说明 |
| ----- | ----- | ----  | ------------------------------------------------------ |
| data   | string  | 任意字符串     | 如果修改成功则不返回该字段，否则返回失败原因 |

示例1：

```json
// 修改配置成功
// 服务端
{
    "serialNo": "6w8keif5g6",
    "uuid": "123456",
    "time": 1756571618,
    "data": {
        "access": {
            "offlineAcsNum":4000,
        },
	},
    "sign": ""
}
// 客户端
{
	"serialNo": "6w8keif5g6",
	"uuid": "123456",
    "time": 1756571619,
    "sign": "",
	"code": "000000"
}
```
示例2：

```json
// 修改配置失败
// 服务端
{
    "serialNo": "6w8keif5g6",
    "uuid": "123456",
    "time": 1756571618,
    "data": {
        "sys": {
            "uuid":"000000",
        },
	},
    "sign": ""
}
// 客户端
{
	"serialNo": "6w8keif5g6",
	"uuid": "123456",
    "time": 1756571619,
    "data": "The uuid is read-only",
    "sign": "",
	"code": "100001"
}
```


#### 1.3 设备升级

- 服务端： access_device/v2/cmd/{uuid}/upgradeFirmware

| 参数名 | 参数名 |  参数名 | 数据类型 | 数据范围  | 说明 |
| ----- | -----  | ----- | ----- | ----  | ------------------------------------------------------ |
| data   | || object | json格式     |  |
|    | type|| int |   0,10   | 升级类型，0：固件升级，10：用户资源升级 |
|    | url|| string |    URL格式，长度0-2048  | 升级包下载地址 |
|    | md5|| string |    MD5格式，长度0-128  | 升级包MD5 |
|    | extra|| object |   json格式，可选   | 扩展字段，仅对type=10时开放，更新的用户资源可在base.userdata配置字段中查看 |
|    | |  name  | string |   资源名称，长度0-64   | 用户资源，包括背景图、音频等等 |
|    | | mode |int |   0,1   | 资源升级模式，0：删除本地此名称的资源，1：添加此资源 |


- 客户端：access_device/v2/cmd/upgradeFirmware\_reply

| 参数名 | 数据类型 | 数据范围  | 说明 |
| ----- | ----- | ----  | ------------------------------------------------------ |
| data   | string  | 任意字符串     | 如果升级成功则不返回该字段，否则返回失败原因 |



示例1：
```c
// 服务端
{
    "serialNo": "6w8keif5g6",
    "uuid": "123456",
    "time": 1756571618,
    "data": {
        "type": 0,
        "url": "http://10.102.106.165/aio.tar.xz",
        "md5": "521c2bdc835d4f13b5f9d6db164f0881"
	},
    "sign": ""
}
// 客户端
{
	"serialNo": "6w8keif5g6",
	"uuid": "123456",
    "time": 1756571619,
    "sign": "",
	"code": "000000"
}
```


#### 1.4 远程控制

- 服务端： access_device/v2/cmd/{uuid}/control

| 参数名 | 参数名 | 参数名 | 数据类型 | 数据范围  | 说明 |
| ----- | ----- | ----- | ----- | ----  | ------------------------------------------------------ |
| data   |  | |object | json格式     |  |
|    | command || int |   0,1,4,5,6,7   | 控制指令，0：重启 1：远程开门，4：设备重置，5:播放语音，6：屏幕展示图片，7：屏幕展示文字 |
|    | extra || object |   json格式，可选  | 控制扩展字段 |
|    |  | wav | string |     资源名称，长度0-64  | command=5时播放的音频 |
|    |  | image | string |   资源名称，长度0-64   | command=6时展示的图片 |
|    |  | imageTimeout | int |   0-86400   | command=6时图片的显示时间，单位秒 |
|    |  | txt | string |   文字内容，长度0-64   | command=7时展示的文字 |
|    |  | txtTimeout | int |   0-86400   | command=7时文字的显示时间，单位秒 |

- 客户端：access_device/v2/cmd/control\_reply

| 参数名 | 数据类型 | 数据范围  | 说明 |
| ----- | ----- | ----  | ------------------------------------------------------ |
| data   | string  | 任意字符串     | 如果控制成功则不返回该字段，否则返回失败原因 |



### 2. 人员管理类接口

#### 2.1 添加人员

- 服务端： access_device/v2/cmd/{uuid}/insertUser

| 参数名 | 参数名 |   数据类型 | 数据范围  | 说明 |
| ----- | -----  |  ----- | ----  | ------------------------------------------------------ |
| data   | | object | json数组格式，成员是json对象     |  |
|    | id | string |   唯一ID格式，长度6-128   | 用户id |
|    | name| string |    任意字符串，长度0-128  | 用户姓名 |
|    | extra| object |   json格式，可选   | 扩展人员属性（idCard:身份证,type:人员类型），参见门禁权限文档  |


- 客户端：access_device/v2/cmd/insertUser\_reply

| 参数名 | 数据类型 | 数据范围  | 说明 |
| ----- | ----- | ----  | ------------------------------------------------------ |
| data   | string  | 任意字符串     | 如果添加成功则不返回该字段，否则返回失败原因 |




#### 2.2 删除人员
- 服务端： access_device/v2/cmd/{uuid}/delUser

| 参数名 | 数据类型 | 数据范围  | 说明 |
| ----- |  ----- | ----  | ------------------------------------------------------ |
| data   | object | json数组格式，成员是人员id   |  批量删除人员 |


- 客户端：access_device/v2/cmd/delUser\_reply

| 参数名 | 数据类型 | 数据范围  | 说明 |
| ----- | ----- | ----  | ------------------------------------------------------ |
| data   | string  | 任意字符串     | 如果删除成功则不返回该字段，否则返回失败原因 |



示例1：
```c
// 服务端
{
    "serialNo": "6w8keif5g6",
    "uuid": "123456",
    "time": 1756571618,
    "data": ["20190101120101","20190101120102"],
    "sign": ""
}
// 客户端
{
	"serialNo": "6w8keif5g6",
	"uuid": "123456",
    "time": 1756571619,
    "sign": "",
	"code": "000000"
}
```


#### 2.3 清空人员

- 服务端： access_device/v2/cmd/{uuid}/clearUser

| 参数名 |   数据类型 | 数据范围  | 说明 |
| ----- |  ----- | ----  | ------------------------------------------------------ |
| data    | undefined | undefined   |  不需要传data |


- 客户端：access_device/v2/cmd/clearUser\_reply

| 参数名 | 数据类型 | 数据范围  | 说明 |
| ----- | ----- | ----  | ------------------------------------------------------ |
| data   | string  | 任意字符串     | 如果清空成功则不返回该字段，否则返回失败原因 |


#### 2.4 查询人员

- 服务端： access_device/v2/cmd/{uuid}/getUser

| 参数名 | 参数名 |   数据类型 | 数据范围  | 说明 |
| ----- |  ----- |----- | ----  | ------------------------------------------------------ |
| data   | | json格式 |    |  筛选参数 |
|    | id| string |  任意字符串，长度0-128  |  查询指定 id 的人员信息 |
|    | name| string |   任意字符串，长度0-128 |  查询指定 id 的人员信息 |
|    | page| int |  >=0  |  页码，从 0 开始 |
|    | size| int |  >0  |  每页最大数量 |


- 客户端：access_device/v2/cmd/getUser\_reply

| 参数名 |参数名 |参数名 | 数据类型 | 数据范围  | 说明 |
| ----- | ----- |----- | ----- | ----  | ------------------------------------------------------ |
| data   |  | |string  | json格式/任意字符串     | 如果查询成功则返回相关人员信息，否则返回失败原因 |
|    | page| |int |  >=0  |  当前页 |
|    | size| |int |  >0  |  每页最大数量 |
|    | total| |int |  >=0  |  总数 |
|    | totalPage| |int |  >=0  |  总页数 |
|    | count| |int |  >=0  |  当前页实际数 |
|    | content| |object |  人员数组  |  人员表内容 |
|    | | id|string |  任意字符串，长度0-128  |  人员id |
|    | | name|string |  任意字符串，长度0-128  |  人员姓名 |
|    | |extra |string |  json格式  |  人员扩展字段 |


### 3. 凭证管理接口

#### 3.1 添加凭证

- 服务端： access_device/v2/cmd/{uuid}/insertKey

| 参数名 | 参数名 | 参数名 | 数据类型 | 数据范围  | 说明 |
| ----- | ----- | ----- | ----- | ----  | ------------------------------------------------------ |
| data   | | | object | json数组格式，成员是json对象，一次限制100以内     |  |
|    | keyId | | string | 唯一ID格式，长度6-128   | 凭证唯一id标识 |
|    | userId | | string | 唯一ID格式，长度6-128   | 人员的唯一id标识 |
|    | type | | string | 参见附表3    | 凭证类型 |
|    | code | | string | 任意字符串，长度0-2048   | 凭证数据，人脸类型传base64，人脸类型数据较大，建议单个下发 |
|    | extra | | object | json格式，可选   | 其他额外凭证属性 |
|    | | faceType | string | 0,1,2,3   | 注册人脸类型，0：base64，1：特征值，2：Url下载，3：zip包 |


- 客户端：access_device/v2/cmd/insertKey\_reply

| 参数名 | 数据类型 | 数据范围  | 说明 |
| ----- | ----- | ----  | ------------------------------------------------------ |
| data   | string  | 任意字符串     | 如果添加成功则不返回该字段，否则返回失败原因 |

示例1：

```json
// 添加凭证成功
// 服务端
{
    "serialNo": "6w8keif5g6",
    "uuid": "123456",
    "time": 1756571618,
    "data": [{
        "keyId": "key001",
        "userId": "user001",
        "type": "300",
        "code": "base64_face_data_here",
        "extra": {
            "faceType": "0"
        }
    }],
    "sign": ""
}
// 客户端
{
	"serialNo": "6w8keif5g6",
	"uuid": "123456",
    "time": 1756571619,
    "sign": "",
	"code": "000000"
}
```

示例2：

```json
// 添加凭证失败
// 服务端
{
    "serialNo": "6w8keif5g6",
    "uuid": "123456",
    "time": 1756571618,
    "data": [{
        "keyId": "key001",
        "userId": "user001",
        "type": "300",
        "code": "invalid_face_data"
    }],
    "sign": ""
}
// 客户端
{
	"serialNo": "6w8keif5g6",
	"uuid": "123456",
    "time": 1756571619,
    "data": "Invalid face data format",
    "sign": "",
	"code": "100000"
}
```


#### 3.2 查询凭证

- 服务端： access_device/v2/cmd/{uuid}/getKey

| 参数名 | 参数名 | 参数名 | 数据类型 | 数据范围  | 说明 |
| ----- | ----- | ----- | ----- | ----  | ------------------------------------------------------ |
| data   | | | object | json格式     | 筛选参数 |
|    | keyId | | string | 任意字符串，长度0-128   | 查询指定凭证id |
|    | userId | | string | 任意字符串，长度0-128   | 查询指定人员id |
|    | type | | int | 参见附表3   | 查询该id下某一类型，必传，如查询300默认只回复一条 |
|    | page | | int | >=0   | 页码，从0开始，index的传入值必须小于总页码数 |
|    | size | | int | >0   | 每页最大数量，返回范围(0,100] |

- 客户端：access_device/v2/cmd/getKey\_reply

| 参数名 | 参数名 | 参数名 | 数据类型 | 数据范围  | 说明 |
| ----- | ----- | ----- | ----- | ----  | ------------------------------------------------------ |
| data   | | | object | json格式/任意字符串     | 如果查询成功则返回相关凭证信息，否则返回失败原因 |
|    | page | | int | >=0   | 当前页 |
|    | size | | int | >0   | 每页最大数量 |
|    | total | | int | >=0   | 总数 |
|    | totalPage | | int | >=0   | 总页数 |
|    | count | | int | >=0   | 当前页实际数 |
|    | content | | array | 凭证数组   | 凭证表内容 |
|    | | keyId | string | 任意字符串，长度0-128   | 凭证id |
|    | | userId | string | 任意字符串，长度0-128   | 人员id |
|    | | type | string | 参见附表3   | 凭证类型 |
|    | | code | string | 任意字符串，长度0-2048   | 凭证数据，人脸类型传base64 |
|    | | extra | object | json格式   | 凭证扩展字段 |

示例1：

```json
// 查询凭证成功
// 服务端
{
    "serialNo": "6w8keif5g6",
    "uuid": "123456",
    "time": 1756571618,
    "data": {
        "type": 300,
        "page": 0,
        "size": 10
    },
    "sign": ""
}
// 客户端
{
	"serialNo": "6w8keif5g6",
	"uuid": "123456",
    "time": 1756571619,
	"data": {
		"page": 0,
		"size": 10,
		"total": 2,
		"totalPage": 1,
		"count": 2,
		"content": [{
			"keyId": "100001",
			"userId": "13",
			"type": "300",
			"code": "base64_face_data",
			"extra": {
				"faceType": "0"
			}
		}, {
			"keyId": "100002",
			"userId": "12",
			"type": "300",
			"code": "base64_face_data_2"
		}]
	},
    "sign": "",
	"code": "000000"
}
```

示例2：

```json
// 查询凭证失败
// 服务端
{
    "serialNo": "6w8keif5g6",
    "uuid": "123456",
    "time": 1756571618,
    "data": {
        "type": 999,
        "page": 0,
        "size": 10
    },
    "sign": ""
}
// 客户端
{
	"serialNo": "6w8keif5g6",
	"uuid": "123456",
    "time": 1756571619,
	"data": "Invalid credential type",
    "sign": "",
	"code": "100000"
}
```

#### 3.3 删除凭证

- 服务端： access_device/v2/cmd/{uuid}/delKey

| 参数名 | 参数名 | 参数名 | 数据类型 | 数据范围  | 说明 |
| ----- | ----- | ----- | ----- | ----  | ------------------------------------------------------ |
| data   | | | object | json格式     | 删除参数 |
|    | keyIds | | array | 字符串数组   | 凭证唯一id标识，传入要删除的凭证id |
|    | userIds | | array | 字符串数组   | 人员的唯一id标识，传入要删除的人员id |

- 客户端：access_device/v2/cmd/delKey\_reply

| 参数名 | 数据类型 | 数据范围  | 说明 |
| ----- | ----- | ----  | ------------------------------------------------------ |
| data   | string  | 任意字符串     | 如果删除成功则不返回该字段，否则返回失败原因 |

示例1：

```json
// 删除凭证成功
// 服务端
{
    "serialNo": "6w8keif5g6",
    "uuid": "123456",
    "time": 1756571618,
    "data": {
        "keyIds": ["20190101120101", "20190101120102"],
        "userIds": ["20190101120101", "20190101120102"]
    },
    "sign": ""
}
// 客户端
{
	"serialNo": "6w8keif5g6",
	"uuid": "123456",
    "time": 1756571619,
    "sign": "",
	"code": "000000"
}
```

示例2：

```json
// 删除凭证失败
// 服务端
{
    "serialNo": "6w8keif5g6",
    "uuid": "123456",
    "time": 1756571618,
    "data": {
        "keyIds": ["invalid_key_id"]
    },
    "sign": ""
}
// 客户端
{
	"serialNo": "6w8keif5g6",
	"uuid": "123456",
    "time": 1756571619,
	"data": "Credential not found",
    "sign": "",
	"code": "100001"
}
```

#### 3.4 清空凭证

- 服务端： access_device/v2/cmd/{uuid}/clearKey

| 参数名 | 数据类型 | 数据范围  | 说明 |
| ----- | ----- | ----  | ------------------------------------------------------ |
| data   | undefined | undefined   |  不需要传data |

- 客户端：access_device/v2/cmd/clearKey\_reply

| 参数名 | 数据类型 | 数据范围  | 说明 |
| ----- | ----- | ----  | ------------------------------------------------------ |
| data   | string  | 任意字符串     | 如果清空成功则不返回该字段，否则返回失败原因 |

示例1：

```json
// 清空凭证成功
// 服务端
{
    "serialNo": "6w8keif5g6",
    "uuid": "123456",
    "time": 1756571618,
    "sign": ""
}
// 客户端
{
	"serialNo": "6w8keif5g6",
	"uuid": "123456",
    "time": 1756571619,
    "sign": "",
	"code": "000000"
}
```

示例2：

```json
// 清空凭证失败
// 服务端
{
    "serialNo": "6w8keif5g6",
    "uuid": "123456",
    "time": 1756571618,
    "sign": ""
}
// 客户端
{
	"serialNo": "6w8keif5g6",
	"uuid": "123456",
    "time": 1756571619,
	"data": "Device busy, please try again later",
    "sign": "",
	"code": "100002"
}
```

### 4. 权限管理接口

#### 4.1 添加权限

- 服务端： access_device/v2/cmd/{uuid}/insertPermission

| 参数名 | 参数名 | 参数名 | 数据类型 | 数据范围  | 说明 |
| ----- | ----- | ----- | ----- | ----  | ------------------------------------------------------ |
| data   | | | object | json数组格式，成员是json对象，一次限制100以内     |  |
|    | permissionId | | string | 唯一ID格式，长度6-128   | 权限的唯一标识，添加和删除时根据这个标识来判定，建议传32位随机值 |
|    | userId | | string | 唯一ID格式，长度6-128   | 人员唯一标识 |
|    | time | | object | json格式   | 时间区间，参见[附表 4 时间区间说明](#附表 4 时间区间说明) |
|    | extra | | object | json格式，可选   | 其他额外权限属性 |

- 客户端：access_device/v2/cmd/insertPermission\_reply

| 参数名 | 数据类型 | 数据范围  | 说明 |
| ----- | ----- | ----  | ------------------------------------------------------ |
| data   | string  | 任意字符串     | 如果添加成功则不返回该字段，否则返回失败原因 |

示例1：

```json
// 添加权限成功
// 服务端
{
    "serialNo": "6w8keif5g6",
    "uuid": "123456",
    "time": 1756571618,
    "data": [{
        "permissionId": "6584132",
        "userId": "6584132",
        "time": {
            "type": 0
        }
    }],
    "sign": ""
}
// 客户端
{
	"serialNo": "6w8keif5g6",
	"uuid": "123456",
    "time": 1756571619,
    "sign": "",
	"code": "000000"
}
```

示例2：

```json
// 添加权限失败
// 服务端
{
    "serialNo": "6w8keif5g6",
    "uuid": "123456",
    "time": 1756571618,
    "data": [{
        "permissionId": "6584132",
        "userId": "invalid_user",
        "time": {
            "type": 0
        }
    }],
    "sign": ""
}
// 客户端
{
	"serialNo": "6w8keif5g6",
	"uuid": "123456",
    "time": 1756571619,
	"data": "User not found",
    "sign": "",
	"code": "100000"
}
```

#### 4.2 查询权限

- 服务端： access_device/v2/cmd/{uuid}/getPermission

| 参数名 | 参数名 | 参数名 | 数据类型 | 数据范围  | 说明 |
| ----- | ----- | ----- | ----- | ----  | ------------------------------------------------------ |
| data   | | | object | json格式     | 筛选参数 |
|    | permissionId | | string | 任意字符串，长度0-128   | 查询指定权限id |
|    | userId | | string | 任意字符串，长度0-128   | 查询指定人员id |
|    | page | | int | >=0   | 页码，从0开始，index的传入值必须小于总页码数 |
|    | size | | int | >0   | 每页最大数量，返回范围(0,100] |

- 客户端：access_device/v2/cmd/getPermission\_reply

| 参数名 | 参数名 | 参数名 | 数据类型 | 数据范围  | 说明 |
| ----- | ----- | ----- | ----- | ----  | ------------------------------------------------------ |
| data   | | | object | json格式/任意字符串     | 如果查询成功则返回相关权限信息，否则返回失败原因 |
|    | page | | int | >=0   | 当前页 |
|    | size | | int | >0   | 每页最大数量 |
|    | total | | int | >=0   | 总数 |
|    | totalPage | | int | >=0   | 总页数 |
|    | count | | int | >=0   | 当前页实际数 |
|    | content | | array | 权限数组   | 权限表内容 |
|    | | permissionId | string | 任意字符串，长度0-128   | 权限id |
|    | | userId | string | 任意字符串，长度0-128   | 人员id |
|    | | time | object | json格式   | 时间区间，参见[附表 4 时间区间说明](#附表 4 时间区间说明) |
|    | | extra | object | json格式   | 权限扩展字段 |

示例1：

```json
// 查询权限成功
// 服务端
{
    "serialNo": "6w8keif5g6",
    "uuid": "123456",
    "time": 1756571618,
    "data": {
        "page": 0,
        "size": 100
    },
    "sign": ""
}
// 客户端
{
	"serialNo": "6w8keif5g6",
	"uuid": "123456",
    "time": 1756571619,
	"data": {
		"page": 0,
		"size": 100,
		"total": 1,
		"totalPage": 1,
		"count": 1,
		"content": [{
			"permissionId": "6584132",
			"userId": "12345",
			"time": {
				"type": 3,
				"range": {
					"beginTime": 1640917147,
					"endTime": 1790917147
				},
				"weekPeriodTime": {
					"1": "9:00-14:05",
					"2": "12:00-13:30|15:00-16:30"
				}
			},
			"extra": {
				"xxx": "xxx",
				"xxxx": "xxxx"
			}
		}]
	},
    "sign": "",
	"code": "000000"
}
```

示例2：

```json
// 查询权限失败
// 服务端
{
    "serialNo": "6w8keif5g6",
    "uuid": "123456",
    "time": 1756571618,
    "data": {
        "page": 0,
        "size": 100
    },
    "sign": ""
}
// 客户端
{
	"serialNo": "6w8keif5g6",
	"uuid": "123456",
    "time": 1756571619,
	"data": "Device busy, please try again later",
    "sign": "",
	"code": "100000"
}
```

#### 4.3 删除权限

- 服务端： access_device/v2/cmd/{uuid}/delPermission

| 参数名 | 参数名 | 参数名 | 数据类型 | 数据范围  | 说明 |
| ----- | ----- | ----- | ----- | ----  | ------------------------------------------------------ |
| data   | | | object | json格式     | 删除参数 |
|    | userIds | | array | 字符串数组   | 人员唯一标识，传入要删除的人员id |
|    | permissionIds | | array | 字符串数组   | 权限的唯一标识，传入要删除的权限id |

- 客户端：access_device/v2/cmd/delPermission\_reply

| 参数名 | 数据类型 | 数据范围  | 说明 |
| ----- | ----- | ----  | ------------------------------------------------------ |
| data   | string  | 任意字符串     | 如果删除成功则不返回该字段，否则返回失败原因 |

示例1：

```json
// 删除权限成功
// 服务端
{
    "serialNo": "6w8keif5g6",
    "uuid": "123456",
    "time": 1756571618,
    "data": {
        "userIds": ["20190101120101", "20190101120102"],
        "permissionIds": ["perm001", "perm002"]
    },
    "sign": ""
}
// 客户端
{
	"serialNo": "6w8keif5g6",
	"uuid": "123456",
    "time": 1756571619,
    "sign": "",
	"code": "000000"
}
```

示例2：

```json
// 删除权限失败
// 服务端
{
    "serialNo": "6w8keif5g6",
    "uuid": "123456",
    "time": 1756571618,
    "data": {
        "userIds": ["invalid_user"]
    },
    "sign": ""
}
// 客户端
{
	"serialNo": "6w8keif5g6",
	"uuid": "123456",
    "time": 1756571619,
	"data": "User not found",
    "sign": "",
	"code": "100000"
}
```

#### 4.4 清空权限

- 服务端： access_device/v2/cmd/{uuid}/clearPermission

| 参数名 | 数据类型 | 数据范围  | 说明 |
| ----- | ----- | ----  | ------------------------------------------------------ |
| data   | undefined | undefined   |  不需要传data |

- 客户端：access_device/v2/cmd/clearPermission\_reply

| 参数名 | 数据类型 | 数据范围  | 说明 |
| ----- | ----- | ----  | ------------------------------------------------------ |
| data   | string  | 任意字符串     | 如果清空成功则不返回该字段，否则返回失败原因 |

示例1：

```json
// 清空权限成功
// 服务端
{
    "serialNo": "6w8keif5g6",
    "uuid": "123456",
    "time": 1756571618,
    "sign": ""
}
// 客户端
{
	"serialNo": "6w8keif5g6",
	"uuid": "123456",
    "time": 1756571619,
    "sign": "",
	"code": "000000"
}
```

示例2：

```json
// 清空权限失败
// 服务端
{
    "serialNo": "6w8keif5g6",
    "uuid": "123456",
    "time": 1756571618,
    "sign": ""
}
// 客户端
{
	"serialNo": "6w8keif5g6",
	"uuid": "123456",
    "time": 1756571619,
	"data": "Device busy, please try again later",
    "sign": "",
	"code": "100000"
}
```


## 三. 事件类型
#### 1. 告警上报

- 客户端： access_device/v2/event/alarm

| 参数名| 参数名 | 数据类型 | 数据范围  | 说明 |
| ----- | ----- | ----- | ----  | ------------------------------------------------------ |
| data   || object | json格式，参见设备配置文档     | 修改设备配置，"组名.组员" |
|    |type| int | 参见附录2     | 上报类型 |
|    |value| int | 参见附录2     | 上报状态 |
|    |door| int | 参见附录2     | 对应门的序号 |

- 服务端：access_device/v2/event/{uuid}/alarm\_reply

| 参数名 | 数据类型 | 数据范围  | 说明 |
| ----- | ----- | ----  | ------------------------------------------------------ |
| data   | -  | -     | 不处理回复 |


#### 2. 心跳上报

- 客户端： access_device/v2/event/heartbeat

| 参数名| 参数名 | 数据类型 | 数据范围  | 说明 |
| ----- | ----- | ----- | ----  | ------------------------------------------------------ |


- 服务端：access_device/v2/event/{uuid}/heartbeat\_reply

| 参数名 | 数据类型 | 数据范围  | 说明 |
| ----- | ----- | ----  | ------------------------------------------------------ |
| data   | -  | -     | 不处理回复 |



#### 3. 遗嘱上报

- 客户端： access_device/v2/event/offline

| 参数名| 参数名 | 数据类型 | 数据范围  | 说明 |
| ----- | ----- | ----- | ----  | ------------------------------------------------------ |


- 服务端：access_device/v2/event/{uuid}/offline\_reply

| 参数名 | 数据类型 | 数据范围  | 说明 |
| ----- | ----- | ----  | ------------------------------------------------------ |
| data   | -  | -     | 不处理回复 |



#### 4. 连接上报

- 客户端： access_device/v2/event/connect

| 参数名| 数据类型 | 数据范围  | 说明 |
| ----- | ----- | ----  | ------------------------------------------------------ |
| data   | object | json格式，参见设备配置文档     | 返回所有设备配置 |


- 服务端：access_device/v2/event/{uuid}/connect\_reply

| 参数名 | 数据类型 | 数据范围  | 说明 |
| ----- | ----- | ----  | ------------------------------------------------------ |
| data   | -  | -     | 不处理回复 |



#### 5. 在线验证

- 客户端： access_device/v2/event/access_online

| 参数名 | 参数名 | 参数名 | 数据类型 | 数据范围  | 说明 |
| ----- | ----- | ----- | ----- | ----  | ------------------------------------------------------ |
| data   | | | object | json格式     | 上报权限表记录对象 |
|    | code | | string | 任意字符串，长度0-128   | 权限凭证，如果是人脸则为空 |
|    | type | | int | 参见附录-设备状态码表-type列   | 权限类型 |
|    | index | | string | 任意字符串，长度0-32   | 门控编号，比如设备是一控四，index可能就是1，2，3，4，可以为空 |
|    | time | | long | 时间戳格式   | 通行时间，时间戳单位秒 |
|    | extra | | object | json格式，可选   | 额外参数，可扩展，通常是记录原始数据，比如扫二维码的原文 |
|    | | srcData | string | 任意字符串，长度0-2048   | 数据原文，原始数据 |

- 服务端：access_device/v2/event/{uuid}/access_online\_reply

| 参数名 | 数据类型 | 数据范围  | 说明 |
| ----- | ----- | ----  | ------------------------------------------------------ |
| data   | string | 任意字符串  | 如果验证成功则不返回该字段，否则返回失败原因 |

示例1：

```json
// 在线验证成功
// 客户端
{
    "serialNo": "6w8keif5g6",
    "uuid": "0a1b2c3d",
    "time": 1647580466,
    "data": {
        "code": "s345463434gg",
        "type": 103,
        "time": 1640917147,
        "extra": {
            "srcData": "vg://v203AQAGAHZndWFuZwIAQAAlcOsQMXN9TJGCK5Afs14p4orxE+QnmI4gb2F85pvrvbQW1/+CyPEE1Bi3X4T3SYFZRoheykjICfdwWU+kw/Vf2965"
        }
    },
    "sign": ""
}
// 服务端
{
    "serialNo": "6w8keif5g6",
    "uuid": "0a1b2c3d",
    "time": 1647580467,
    "sign": "",
    "code": "000000",
    "message": "成功"
}
```

示例2：

```json
// 在线验证失败
// 客户端
{
    "serialNo": "6w8keif5g6",
    "uuid": "0a1b2c3d",
    "time": 1647580466,
    "data": {
        "code": "invalid_code",
        "type": 103,
        "time": 1640917147
    },
    "sign": ""
}
// 服务端
{
    "serialNo": "6w8keif5g6",
    "uuid": "0a1b2c3d",
    "time": 1647580467,
    "data": "Invalid credential",
    "sign": "",
    "code": "100000",
    "message": "验证失败"
}
```

#### 6. 通行记录上报

- 客户端： access_device/v2/event/access

| 参数名 | 参数名 | 参数名 | 数据类型 | 数据范围  | 说明 |
| ----- | ----- | ----- | ----- | ----  | ------------------------------------------------------ |
| data   | | | object | json格式     | 上报通行表记录数组 |
|    | content | | array | 记录数组   | 详见content数据表 |
|    | | userId | string | 任意字符串，长度0-128   | 用户ID |
|    | | type | int | 参见附表3   | 用户类型，当人卡码任一时参考附表3权限类型说明-num，若人卡\人码合一时，填写人卡301，人码302 |
|    | | timestamp | int | 时间戳格式   | 通行时间戳 |
|    | | result | int | 0,非0   | 通行结果，0-成功，非0失败 |
|    | | name | string | 任意字符串，长度0-128   | 人员姓名 |
|    | | code | string | 任意字符串，长度0-2048   | 通行照片/卡号/码值/密码/蓝牙，type=300/301/302时填写Base64照片数据，其他类型填写对应凭证值 |
|    | | extra | object | json格式，可选   | 其他数据，当人卡\人码合一时，填写卡号或码值；可填写体温信息 |
|    | | | temperature | float | 浮点数   | 体温 |
|    | | | code | string | 任意字符串，长度0-128   | 人卡/人码核验时，填写卡值或码值 |
|    | | error | string | 任意字符串，长度0-128   | 错误信息 |

- 服务端：access_device/v2/event/{uuid}/access\_reply

| 参数名 | 数据类型 | 数据范围  | 说明 |
| ----- | ----- | ----  | ------------------------------------------------------ |
| data   | -  | -     | 不处理回复 |

示例1：

```json
// 通行记录上报成功
// 客户端
{
    "serialNo": "0000000001",
    "uuid": "p0Lx8TI3mpOr",
    "time": 0,
    "sign": "",
    "data": {
        "content": [{
            "userId": "412725202101011234",
            "type": 302,
            "timeStamp": 1639475284,
            "result": 0,
            "error": "成功",
            "name": "张三",
            "code": "/9j/4AAQSkZJRgABAQEAYABgAAD…",
            "extra": {
                "code": "&llgyAQASADQxMjcyNTIwMjEwMTAxMTIzNA==\@3Fa",
                "temperature": 36.5
            }
        }]
    }
}
// 服务端
{
    "serialNo": "0000000001",
    "uuid": "p0Lx8TI3mpOr",
    "time": 0,
    "sign": "",
    "code": "000000",
    "message": "成功"
}
```

示例2：

```json
// 通行记录上报失败
// 客户端
{
    "serialNo": "0000000001",
    "uuid": "p0Lx8TI3mpOr",
    "time": 0,
    "sign": "",
    "data": {
        "content": [{
            "userId": "412725202101011234",
            "type": 302,
            "timeStamp": 1639475284,
            "result": 1,
            "error": "权限验证失败",
            "name": "张三",
            "code": "/9j/4AAQSkZJRgABAQEAYABgAAD…"
        }]
    }
}
// 服务端
{
    "serialNo": "0000000001",
    "uuid": "p0Lx8TI3mpOr",
    "time": 0,
    "sign": "",
    "code": "000000",
    "message": "成功"
}
```

附录1
------------------

| code          | 说明                      |
| ------------- | ----------------------    |
| 000000        | 成功              |
| 100000        | 未知错误                  |
| 100001        | 设备配置错误              |
| 100002        | 设备忙碌      |
| 100003        | 签名检验失败              |
| 100004        | 超时错误                  |



附录2
------------------

| type          | value          |door| 说明                      |
| ------------- | ------------- | ----------- | ----------------------    |
| 0        | 0：门磁关、1：门磁开   |  对应门的序号   | 门磁状态              |
| 1        | 0：火警关、1：火警开   |  -  | 火警状态                  |
| 2        | -      | 对应门的序号 | 非法开门              |
| 3        | -      | 对应门的序号 | 开门超时      |
| 5        | -      | - | 防拆报警                  |



## 附表 3 权限类型说明

| type        | num           | 说明                                          |
| ----------- | ------------- | --------------------------------------------- |
| face        | 300           | 300:人脸数据                                  |
| qrcode      | 100、101、103 | 100：透传码,101：静态码 ,103：动态码          |
| password    | 400           | 400：密码数据 ，密码长度：6位                 |
| card        | 200           | 200:普通卡号，201：cpu加密卡，202：扇区加密卡 |
| fingerprint | 500           | 500：指纹数据                                 |
| bluetooth   | 600           | 600:蓝牙开门凭证                              |
| openButton  | 800           | 800:开门按钮                                  |

## 附表 4 时间区间说明

支持下面四种时间区域设置：

- 1.缺省模式，不限时间，一直有效

```c
{
    "type": 0
}
```

- 2.通常模式，从开始到结束时间内有效

```c
{
    "type": 1,
    "range": {
      "beginTime": 1640917147,
      "endTime": 1690917147
    }
}
```

- 3.每日模式，每日特定时间到特定时间内有效(时间戳为当日零点到该时间的秒数)

```c
{
    "type": 2,
    "beginTime": 30600,
    "endTime": 66600,
    "range": {
      "beginTime": 1640917147,
      "endTime": 1690917147
    }
}
```

- 4.周重复模式，周一到周日特定时间到特定时间内有效，其它时间无效(每天的多组时间段不重叠，最多支持五组)。weekPeriodTime参数如下，每天的时间格式为："HH:MM-HH:MM"，24小时制时分，Eg："08:00-09:30|10:00-11:30"最多5个时间段。1~7至少有一天为必传,无此项代表无权限，"00:00-24:00"：代表全天有效，多个时间段用 | 分割中间不要有空格，每天最多5个时间段Eg:"08:00-09:30|10:00-11:30|12:00-13:30|15:00-16:30|17:00-18:30"

```c
{
    "type": 3,
    "weekPeriodTime":{
      "1":"9:00-10:00",
      "2":"12:00-13:30|15:00-16:30"
    },
    "range": {
      "beginTime": 1640917147,
      "endTime": 1690917147
    }
}
```
```